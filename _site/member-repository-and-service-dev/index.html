<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>레파지토리와 서비스 개발 | Pam Tree</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>레파지토리와 서비스 개발 | Pam Tree</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="레파지토리와 서비스 개발" />
<meta name="author" content="pam" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="```java @Entity @Getter public class Member { @Id @GeneratedValue @Column(name = “member_id”) private Long id;" />
<meta property="og:description" content="```java @Entity @Getter public class Member { @Id @GeneratedValue @Column(name = “member_id”) private Long id;" />
<link rel="canonical" href="http://localhost:4000/member-repository-and-service-dev/" />
<meta property="og:url" content="http://localhost:4000/member-repository-and-service-dev/" />
<meta property="og:site_name" content="Pam Tree" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-22T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="레파지토리와 서비스 개발" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pam"},"dateModified":"2023-11-22T00:00:00+09:00","datePublished":"2023-11-22T00:00:00+09:00","description":"```java @Entity @Getter public class Member { @Id @GeneratedValue @Column(name = “member_id”) private Long id;","headline":"레파지토리와 서비스 개발","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/member-repository-and-service-dev/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"pam"},"url":"http://localhost:4000/member-repository-and-service-dev/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Pam Tree">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="/index.html"> My Resume</a>
                </li>

                <!-- <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li> -->

                <li class="nav-item">
                <a target="_blank" class="nav-link" href=""><i class="fab fa-github"></i> My Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Pam Tree</h1>
    <p class="lead">
        팜의 백엔드 이것저것 놀이터
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=레파지토리와 서비스 개발&url=http://localhost:4000/member-repository-and-service-dev/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/member-repository-and-service-dev/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/member-repository-and-service-dev/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/manulGaming.jpg" alt="Pam">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://www.wowthemes.net">Pam</a><a target="_blank" href="" class="btn follow">Follow</a>
                        <span class="author-description">Author of Mediumish, a Bootstrap Medium styled template available for WordPress, HTML, Ghost and Jekyll. You are currently previewing Jekyll template demo.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">레파지토리와 서비스 개발</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Embedded</span>
    <span class="kd">private</span> <span class="nc">Address</span> <span class="n">address</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"member"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>주어진 회원 도메인은 위와 같다.</p>

<hr />
<h3 id="회원-레파지토리-개발">회원 레파지토리 개발</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">jpabook.jpashop.repository</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepository</span> <span class="o">{</span>
    <span class="nd">@PersistenceContext</span>
    <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">find</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">,</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m where m.name = :name"</span><span class="o">,</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
                <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Repository</strong>는 계층형 아키텍쳐에서 Persistence Layer에 속하는 개념으로, <strong>데이터베이스나 데이터 저장소와 상호 작용</strong>한다.<br />
이렇게 Repository에 데이터베이스와의 상호작용의 책임을 부여함으로써 객체 지향 프로그래밍과 데이터베이스 연동 작업을 간소화하고 추상화할 수 있다.
<br /><br /></p>

<p>지금부터 위 코드에서 사용된 개념을 하나씩 짚어서 살펴보자.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">@PersistenceContext</code></strong>: 컨테이너가 EntityManager를 관리하고 주입</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>    <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"helloJPA"</span><span class="o">);</span>
    <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>

    <span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
    <span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

		<span class="o">...</span><span class="na">code</span>

    <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>

    <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>기존 JPA 구현 코드와 SpringBoot에서의 JPA 코드를 비교해보자. 기존 JPA에서는 엔티티 매니저 팩토리와 엔티티 매니저를 생성 했으나 SpringBoot에서는 둘 다 생성하지 않은 것을 확인할 수 있다.</p>

<p>이는 <strong>SpringBoot Starter Data JPA 라이브러리</strong>를 사용하고 있기 때문으로, 해당 라이브러리는 Spring Data JPA 라이브러리에서 yml 설정 파일을 읽어 <strong>엔티티 매니저 팩토리와 엔티티 매니저를 생성</strong>하는 기능을 제공한다.</p>

<p>또한 개발자가 직접 엔티티 매니저를 생성하지 않아도 <code class="language-plaintext highlighter-rouge">@PersistenceContext</code> 어노테이션을 통해 스프링에서 생성한 엔티티 매니저를 주입받는다.
<br /><br /></p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">createQuery(String qlString, Class&lt;T&gt; resultClass);</code></strong>: 객체를 조회하기 위한 JPQL
    <ul>
      <li>qlString: JPQL 쿼리 문자열</li>
      <li>resultClass: 쿼리 결과를 매핑할 Java 클래스</li>
    </ul>
  </li>
</ul>

<p>SQL과 JPQL 모두 데이터베이스에서 정보를 조회하고 수정하기 위해 사용된다. JPQL은 실행 시에 JPA 구현체에 의해 SQL로 변환되어 실제 데이터베이스에 전달되며, JPQL은 SQL에 포함되는 개념이다.
하지만 SQL은 테이블을 대상으로 쿼리를 작성하나 JPQL은 엔티티 객체를 대상으로 쿼리를 작성한다.<br />
따라서 JPQL은 SQL과 문법상 차이를 보인다. 위 예시의 JPQL String <code class="language-plaintext highlighter-rouge">select m from Member m</code>에서 나타나는 Member는 테이블 명이 아닌 <strong>객체 Member</strong>를 의미한다.</p>

<h3 id="회원-서비스-개발">회원 서비스 개발</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">jpabook.jpashop.service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="c1">//회원 가입</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">join</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">validateMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="k">return</span>  <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">validateMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">findMembers</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByName</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">findMembers</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"이미 존재하는 회원입니다."</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 회원 조회</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMembers</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findMember</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">@Transactional</code></strong>: 로직을 트랜젝션 내에서 수행되도록 함</li>
  <li><strong><code class="language-plaintext highlighter-rouge">@Autowired</code></strong>: 자동 의존성 주입을 수행
MemberService에서 MemberRepository를 사용하기 위해 @Autowired를 사용해 레파지토리를 주입해주었다.
@Autowired를 사용하면 Spring은 자동으로 해당 타입의 빈을 찾아 필드, 메서드, 생성자를 자동으로 주입해준다. 우리는 뮈 예제에서 필드 주입을 위해 @Autowired 어노테이션을 사용했다.</li>
</ul>

<h4 id="1-field-injection필드-주입">1. Field Injection(필드 주입)</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>필드 주입은 사용하려는 Controller의 필드에 직접 <code class="language-plaintext highlighter-rouge">@Autowired</code>를 부여하는 방법이다.<br />
그러나 Field Injection 사용시 final 제어자를 사용이 불가능하며, 객체의 변경 가능성을 열어두어 Service의 불변성을 보장하지 못한다.
또한 테스트 코드 작성시 주입받는 객체의 생성이 어려우며, 따라서 단위 테스트가 불가능하다. 따라서 Field Injection은 지양해 사용하여야 한다.</p>

<h4 id="2-setter-injection수정자-주입">2. Setter Injection(수정자 주입)</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMemberRepository</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>위와 같이 Setter Injection을 사용하면 테스트 코드를 작성할 때 개발자가 직접 주입이 가능하다는 장점이 있다.<br />
그러나 실제로 애플리케이션 동작 중에 객체를 변경하게 될 일은 거의 없으므로, 잘 쓰이지 않는 주입법이다.</p>

<h4 id="3-constructor-injection생성자-주입">3. Constructor Injection(생성자 주입)</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="c1">//@Autowired</span>
    <span class="kd">public</span> <span class="nf">MemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>가장 권장되는 Injection 방식이다.<br />
생성자 주입은 Service를 생성할 때 객체의 주입을 완료하기 때문에 중간에 객체의 변경이 불가능하며, 의존중인 객체들 중 하나라도 주어지지 않으면 객체 생성이 불가능하다.
또한 final 제어자를 사용해 불변성을 보장할 수 있다.
<code class="language-plaintext highlighter-rouge">@Autowired </code>어노테이션을 작성하지 않아도 생성자를 작성할 경우 자동으로 Injection을 하는 기능을 Spring이 제공하나. 생성자 작성 대신 Lombok에서 제공하는 <code class="language-plaintext highlighter-rouge">@RequiredArgsConsturctor</code> 어노테이션을 사용할 수도 있다.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">@RequiredArgsConsturctor</code></strong>: 생성자를 작성하지 않아도 final 제어자가 있는 필드에 대해서 생성자를 생성해준다.</li>
</ul>

<h3 id="회원-기능-테스트">회원 기능 테스트</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">jpabook.jpashop.repository</span><span class="o">;</span>

<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">SpringExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">MemberRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMember</span> <span class="o">()</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setUserName</span><span class="o">(</span><span class="s">"memberA"</span><span class="o">);</span>
        
        <span class="nc">Long</span> <span class="n">saveid</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="nc">Member</span> <span class="n">findMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">saveid</span><span class="o">);</span>

        <span class="n">assertEquals</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getUserName</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getUserName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">@ExtendWith(SpringExtension.class)</code></strong>: JUnit에게 스프링 관련 테스트를 함을 알리기 위한 어노테이션</li>
  <li><strong><code class="language-plaintext highlighter-rouge">@SpringBootTest</code></strong>: 스프링 부트로 테스트하기 위한 어노테이션</li>
</ul>

<p><br /></p>

<p class="box-error"><strong>No EntityManager with actual transaction available for current thread - cannot reliably process ‘persist’ call</strong></p>

<p>위 테스트 코드를 실행하면 위와 같은 에러가 발생한다. 에러를 보면 알 수 있듯이 이는 트랜잭션이 존재하지 않기에 발생하는 문제이다.</p>

<p>엔티티 매니저를 통한 모든 변경은 트랜잭션 안에서 이루어져야 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre> 		<span class="nd">@Test</span>
        <span class="nd">@Transactional</span>
		<span class="nd">@Rollback</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMember</span> <span class="o">()</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setUserName</span><span class="o">(</span><span class="s">"memberA"</span><span class="o">);</span>
        
        <span class="nc">Long</span> <span class="n">saveid</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="nc">Member</span> <span class="n">findMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">saveid</span><span class="o">);</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">saveid</span><span class="o">);</span>

        <span class="n">assertEquals</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getUserName</span><span class="o">(),</span> <span class="n">member</span><span class="o">.</span><span class="na">getUserName</span><span class="o">());</span>

    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">@Transactional</code></strong>: 스프링의 선언적 트랜잭션 설정 어노테이션
    <ul>
      <li>테스트에 존재할 시 테스트 종료 후 DB를 롤백한다.</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">@Rollback(value = false)</code></strong>: Transactional의 DB 롤백 설정을 False로 한다.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">@Rollback(value = false)</code> 어노테이션 없이 <code class="language-plaintext highlighter-rouge">@Transactional</code>만 사용할 경우 Insert 쿼리가 실행되지 않음을 확인할 수 있다.
쿼리는 영속성 컨텍스트 내에 있는 멤버 객체가 flush가 될 때 실행되는데, <code class="language-plaintext highlighter-rouge">@Transactional</code> 어노테이션이 트랜잭션의 커밋 이전에 롤백을 하기 때문이다.
실제로 <code class="language-plaintext highlighter-rouge">@Rollback(value = false)</code>을 사용하지 않을 경우 테스트 코드를 실행해도 데이터베이스에 저장되지 않음을 확인할 수 있다.</p>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-11-22">22 Nov 2023</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Spring">Spring</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#jpa">#jpa</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#spring,">#spring,</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//application-architecture/"> &laquo; 애플리케이션 아키텍쳐</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//blog_update3/">23.11.22 블로그 업데이트3 &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <script src="https://utteranc.es/client.js"
        repo="lcqff/blog_comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<!-- 
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#tutorial">tutorial (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#flutter">flutter (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Javascript">Javascript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#React">React (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#KakaoTecCampus">KakaoTecCampus (17)</a>
                
                    <a class="mt-1 mb-1" href="/categories#블로그_업데이트">블로그_업데이트 (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Algorithm">Algorithm (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CS">CS (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Spring">Spring (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Works">Works (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#JPA">JPA (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Java">Java (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#오류기록장">오류기록장 (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#BDD">BDD (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Keeper">Keeper (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DooRe">DooRe (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Infra">Infra (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#세차새차">세차새차 (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#일상">일상 (2)</a>
                
            
            
		</div>
	</div>
</div> -->

<div class="jumbotron fortags">
	<div class="d-flex h-100 justify-content-center">
		<div class="col-12 py-3">
            <div class="category-container">
                <div class="category-item">
                    <div class="parent_cat" style="font-weight: bold;">
                        <a href="/index.html">
                             전체 글
                             <span>63</span>
                        </a>
                    </div>
                </div>
                
                <!-- 카테고리 목록을 가로로 배치 -->
                <div class="category-item">
                    <div class="parent_cat">CS</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#CS">
                                    CS
                                    <span>2</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Algorithm">
                                    Algorithm
                                    <span>2</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">BackEnd</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#Keeper">
                                    Keeper
                                    <span>2</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#DooRe">
                                    DooRe
                                    <span>4</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#세차새차">
                                    세차새차
                                    <span>3</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Infra">
                                    Infra
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Spring">
                                    Spring
                                    <span>5</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Java">
                                    Java
                                    <span>5</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#JPA">
                                    JPA
                                    <span>3</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#오류기록장">
                                    오류기록장
                                    <span>1</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">BDD</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#BDD">
                                    BDD
                                    <span>1</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">FrontEnd</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#Javascript">
                                    Javascript
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#React">
                                    React
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#KakaoTecCampus">
                                    KakaoTecCampus
                                    <span>17</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#flutter">
                                    flutter
                                    <span>3</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Works">
                                    Works
                                    <span>1</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">기타</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#블로그_업데이트">
                                    블로그_업데이트
                                    <span>7</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#일상">
                                    일상
                                    <span>2</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2024 Pam Tree 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 

<!-- 
<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>
 -->

</body>
</html>
