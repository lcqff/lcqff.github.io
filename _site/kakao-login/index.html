<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>카카오 로그인 api로 알아보는(1) -소셜 로그인 | Pam Tree</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>카카오 로그인 api로 알아보는(1) -소셜 로그인 | Pam Tree</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="카카오 로그인 api로 알아보는(1) -소셜 로그인" />
<meta name="author" content="pam" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="개요" />
<meta property="og:description" content="개요" />
<link rel="canonical" href="http://localhost:4000/kakao-login/" />
<meta property="og:url" content="http://localhost:4000/kakao-login/" />
<meta property="og:site_name" content="Pam Tree" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-01T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="카카오 로그인 api로 알아보는(1) -소셜 로그인" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pam"},"dateModified":"2024-05-01T00:00:00+09:00","datePublished":"2024-05-01T00:00:00+09:00","description":"개요","headline":"카카오 로그인 api로 알아보는(1) -소셜 로그인","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/kakao-login/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"pam"},"url":"http://localhost:4000/kakao-login/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Pam Tree">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="/index.html"> My Resume</a>
                </li>

                <!-- <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li> -->

                <li class="nav-item">
                <a target="_blank" class="nav-link" href=""><i class="fab fa-github"></i> My Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Pam Tree</h1>
    <p class="lead">
        팜의 백엔드 이것저것 놀이터
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=카카오 로그인 api로 알아보는(1) -소셜 로그인&url=http://localhost:4000/kakao-login/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/kakao-login/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/kakao-login/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/manulGaming.jpg" alt="Pam">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://github.com/lcqff">Pam</a><a target="_blank" href="" class="btn follow">Follow</a>
                        <span class="author-description"></span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">카카오 로그인 api로 알아보는(1) -소셜 로그인</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <h2 id="개요">개요</h2>

<p>만들어보고 싶었던 어플리케이션을 제작하며 우선적으로 소셜 로그인 기능을 만들어보기로 했다.</p>

<p>개인적으로 동작이 궁금했고 공부해보고싶었던 분야이기도 하고, 권한은 전체적인 애플리케이션 기능에 사용될테니 차라리 미리 만들어두는게 좋겠다 생각했기 때문이다.</p>

<p>실제 코드 작성에 앞서 로그인은 어떤 방식으로 이루어지며, 그중 소셜 로그인은 또 어떻게 다른지 알아보도록 하자~</p>

<h2 id="http-프로토콜-왜-사용자-정보를-저장해야할까">HTTP 프로토콜: 왜 사용자 정보를 저장해야할까?</h2>
<h3 id="statuful-통신의-한계">Statuful 통신의 한계</h3>

<div class="callout">
  <div>💡</div>
  <div>
	<strong>stateful(상태 유지)</strong><br />
	서버가 클라이언트의 상태를 보존하는 것
  </div>
</div>

<p>예를 들어 쿠키나 세션을 통해 서버에 클라이언트 인증 정보를 저장하여 클라이언트가 다른 페이지로 이동하더라도 로그인 상태가 유지되는 것을 <strong>stateful</strong>하다고 한다.</p>

<ul>
  <li>서버에 클라이언트의 상태가 저장되는 만큼 statuful 통신은 서버의 부하가 크다.
    <ul>
      <li>서버가 1만명의 클라이언트 정보를 저장할 수 있다면, 1만 명 이상이 연결될 경우 1만 번째 이후의 클라이언트들은 이미 연결된 클라이언트가 빠져나가고 나서야 처리될 수 있다.</li>
    </ul>
  </li>
  <li>클라이언트의 정보를 저장하고 있던 기존 서버에 장애가 생겨 다른 서버에 연결되는 경우 클라이언트의 정보를 다시 저장하는 문제가 있다.</li>
</ul>

<h3 id="stateless-통신">Stateless 통신</h3>

<div class="callout">
  <div>💡</div>
  <div>
	<strong>Stateless(무상태)</strong><br />
  서버에 클라이언트의 상태가 보존되지 않는다.
  </div>
</div>

<p>stateless 통신에서 서버는 요청이 들어오면 응답을 보내는 역할만 수행하고, <strong>상태관리를 위한 책임은 모두 클라이언트</strong>에게 있다. 클라이언트는 상태 관리를 위해 서버와의 통신에서 상태 정보 데이터를 담아 전달한다.</p>

<ul>
  <li>서버에서 클라이언트의 상태를 저장하지 않으므로 기존 서버에 장애가 생겨 서버가 바뀌더라도 응답에 문제가 없다.</li>
  <li>대량의 트래픽이 발생하더라도 각각의 요청이 독립적으로 처리되므로 서버 확장을 통한 병렬적 처리로 수월하게 해결할 수 있다.</li>
</ul>

<div class="captionedImg">
  <img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/591708e2-0ec2-47de-8339-070f4a12d4b1" />
  여러 서버에서 트래픽이 독립적으로 처리된다. 
</div>

<h3 id="http-프로토콜">HTTP 프로토콜</h3>

<p>HTTP 프로토콜은 <code class="language-plaintext highlighter-rouge">Stateless</code>한 특징을 지닌다. 따라서 로그인을 유지하기 위해선 <strong>모든 요청에 클라이언트의 정보를 담아 보내는 과정</strong>이 필요하다.</p>

<p>결국 로그인 상태의 유무는 <em>요청에 사용자를 인증할 수 있는 정보가 담겨져 있는가</em>로 나누어진다. 즉슨, 사용자 정보의 상태 유지를 통해 로그인을 유지할 수 있다.</p>

<p>그러나 이러한 상태 유지를 위해 매번 파라미터에 사용자 정보를 넘겨주는 작업은 번거롭다. <blue>HTTP 프로토콜에서 상태를 유지하기 위해 제공하는 메커니즘</blue>들을 알아보자.</p>

<h2 id="로그인-방법">로그인 방법</h2>

<p>로그인이란 것은 유지가 되어야 의미가 있다 (당연히, 로그인 페이지를 벗어났을 때 로그인이 풀리면 의미가 없으니까) 로그인을 한다는 것은 사용자 정보가 상태 유지된다는 의미다.</p>

<p>http 통신에서 이러한 상태유지를 위해 사용하는 메커니즘들을 간단히 알아보자.</p>

<p>실제로 사용할 JWT와 OAuth에 대해 자세히 알아볼 것이므로 쿠키와 세션은 개념만 짚고 넘어가겠다.</p>

<h3 id="쿠키">쿠키</h3>

<ul>
  <li>키와 값으로 구성된 클라이언트 상태 정보 데이터 파일로 <strong>클라이언트 로컬에 저장</strong>된다.</li>
  <li>사용자가 요청하지 않아도 브라우저가 알아서 요청의 Request Header에 쿠키를 삽입한다.</li>
  <li>그러나 쿠키값은 변조가 가능하며, <red>민감 정보가 노출</red>된다는 단점이 있다.
    <ul>
      <li>ex) 민감 정보가 쿠키에 저장될 경우 로컬 pc와 클라이언트→서버 네트워크에 노출된다.</li>
      <li>ex) memberId=1이라는 쿠키로 로그인을 유지하는 경우, 쿠키값을 변조하는 것으로 타인의 계정에 로그인할 수 있다.</li>
    </ul>
  </li>
</ul>

<h3 id="세션">세션</h3>

<p>쿠키의 노출 이슈를 보안하기 위해 나온 대안이다.</p>

<p><img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/4c4ca588-470c-441a-b3a5-67512015ce04" alt="세션" /></p>

<ul>
  <li>민감 정보가 노출되지 않도록 <strong>서버에 저장</strong>하는 방법이다.</li>
  <li>쿠키에 사용자 정보가 아닌 <strong>세션 ID</strong>를 저장한다.</li>
  <li>서버에서 sessionId를 통해 사용자 정보를 찾을 수 있다.</li>
  <li>쿠키값(SessionId)가 노출되더라도 중요한 정보가 들어있지 않다.</li>
</ul>

<h3 id="oauth">OAuth</h3>

<div class="callout">
  <div>💡</div>
  <div>
	<strong>Oauth(Open Authorization)</strong><br />
	인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단
  </div>
</div>

<p>사용자가 어떤 애플리케이션에 정보를 직접 제공하는 대신에 카카오톡이나 구글과 같은 <strong>다른 웹사이트에 있는 자신의 정보를 접근</strong>할 수 있도록 하는 것이다.</p>

<p><img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/1dc3f76b-0e06-40e2-a6bd-6ae887980f8f" alt="OAuth" /></p>

<ul>
  <li><strong>자원 서버(Resource Server or Service Server)</strong> : Client가 제어하고자 하는 자원 보유하고 있는 서버 (클라이언트가 실제로 이용하고자 하는 서버)</li>
  <li><strong>인증 서버(Authorization Server)</strong> : 클라이언트가 자원 서버의 서비스를 이용할 수 있게 인증하고 토큰을 발생해주는 서버 ex. 구글, 페이스북 등</li>
</ul>

<p>OAuth은 로그인 방법이라기 보다는 말 그대로 <strong>사용자 정보를 제공해주는 수단</strong>이다. 클라이언트는 Access Token을 통해 인증서버로부터 사용자 정보를 요청할 수 있다.</p>

<p>일반적로 JWT와 함께 사용된다. 이론만 봐서는 session과 함께 사용할수도 있을 것 같지만 따로 저장소를 둘 필요가 없는 JWT가 더 선호되나보다🤔 (JWT에 대해서는 다음 게시글에서 자세히 살펴본다.)</p>

<h2 id="oauth-카카오-로그인">OAuth: 카카오 로그인</h2>

<p>OAuth는 <strong><code class="language-plaintext highlighter-rouge">인가 코드 발급 → Access Token 발급 → 사용자 정보 제공</code></strong>의 3단계로 이루어진다. 실제 카카오 로그인 기능 구현을 해보며 각 단계별 내용을 알아보자.</p>

<p><a href="https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#propertykeys">카카오 로그인 문서(Rest api)</a></p>

<h3 id="0-설정">0. 설정</h3>

<p>카카오 로그인을 사용하기 위해선 코드 작성에 앞서 카카오 developer에 앱을 생성하고, 설정하는 과정이 필요하다. (이 부분을 잘못해서 문제가 자주 발생함…)</p>

<p>그러나 <a href="https://developers.kakao.com/docs/latest/ko/kakaologin/prerequisite">카카오 로그인 문서</a>의 설정하기 페이지에 앞서 필요한 설정들이 상세히 설명돼있다. 따라서 해당 글에서 설명하진 않을 것… <a href="https://velog.io/@appti/Spring-Security-OAuth2-%EC%B9%B4%EC%B9%B4%EC%98%A4">이 블로그 게시글</a>도 많은 도움이 됐다.</p>

<p><br /></p>

<p><img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/cdd9c86a-948b-4f44-ac15-def37c18fbe3" alt="동의항목" /></p>

<p>이 내용은 단순히 참고용으로 작성해두는데, 나의 경우에는 닉네임과 프로필 사진 정보를 필수동의가 아니라 ‘선택 동의’로 설정할 경우 로그인시 동의화면 페이지가 뜨지 않고 사용자 정보에서 profile이 null로 넘어왔다.</p>

<p>필수동의로 설정을 변경하자 동의화면 페이지도 정상적으로 뜨고 profile 내용도 잘 채워져 전달되었다.</p>

<p><br /></p>

<p>추가적으로, 편의를 위해 Spring Security의 <strong><a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html">OAuth2</a>를</strong> 사용했다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">security</span><span class="pi">:</span>
    <span class="na">oauth2</span><span class="pi">:</span>
      <span class="na">client</span><span class="pi">:</span>
        <span class="na">registration</span><span class="pi">:</span>
          <span class="na">kakao</span><span class="pi">:</span>
            <span class="na">client-id</span><span class="pi">:</span> <span class="s">my-client-id</span>
            <span class="na">client-secret</span><span class="pi">:</span> <span class="s">my-client-secret</span>
            <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s">my-redirect-uri</span>
            <span class="na">client-name</span><span class="pi">:</span> <span class="s">Kakao</span>
            <span class="na">scope</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">profile_nickname</span>
              <span class="pi">-</span> <span class="s">profile_image</span>
        <span class="na">provider</span><span class="pi">:</span>
          <span class="na">kakao</span><span class="pi">:</span>
            <span class="na">authorization-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/authorize</span>
            <span class="na">token-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/token</span>
            <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://kapi.kakao.com/v2/user/me</span>
            <span class="na">user-name-attribute</span><span class="pi">:</span> <span class="s">id</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Spring Security OAuth2</code>에서 provider로 kakao를 제공하지 않기 때문에 provider직접 작성해야한다.</p>

<h3 id="1-인가-코드-발급">1. 인가 코드 발급</h3>

<p><img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/e73997c2-7018-4954-a34e-8f167148ec03" alt="인가코드 받기" /></p>

<p>사용자 동의(인가)를 구하는 과정이다. 인가 코드 발급에 성공하면 발급받은 코드를 통해 토큰을 발급 받을 수 있다.</p>

<h4 id="기본정보">기본정보</h4>

<p><strong>URI</strong></p>

<table>
  <thead>
    <tr>
      <th>메서드</th>
      <th>URL</th>
      <th>인증 방식</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>https://kauth.kakao.com/oauth/authorize</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<p><strong>쿼리 파라미터</strong></p>

<table>
  <thead>
    <tr>
      <th>이름</th>
      <th>타입</th>
      <th>설명</th>
      <th>필수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>client_id</td>
      <td>String</td>
      <td>앱 REST API 키[내 애플리케이션] &gt; [앱 키]에서 확인 가능</td>
      <td>O</td>
    </tr>
    <tr>
      <td>redirect_uri</td>
      <td>String</td>
      <td>인가 코드를 전달받을 서비스 서버의 URI[내 애플리케이션] &gt; [카카오 로그인] &gt; [Redirect URI]에서 등록</td>
      <td>O</td>
    </tr>
    <tr>
      <td>response_type</td>
      <td>String</td>
      <td>code로 고정</td>
      <td>O</td>
    </tr>
  </tbody>
</table>

<ul class="box-yello">
  <li><strong>client_id</strong>: 앱을 생성할때 발급받은 <code class="language-plaintext highlighter-rouge">REST_API_KEY</code></li>
  <li><strong>redirect_uri</strong>: 인가 코드 발급이 성공한 후 해당 uri를 자동 호출한다.</li>
</ul>

<p>이 외 필수가 아닌 파라미터는 kakao developer 문서를 참고한다.</p>

<h4 id="코드">코드</h4>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span> <span class="n">_signInWithKakao</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">clientState</span> <span class="o">=</span> <span class="n">Uuid</span><span class="p">()</span><span class="o">.</span><span class="na">v4</span><span class="p">();</span>
      <span class="kd">final</span> <span class="n">url</span> <span class="o">=</span> <span class="kt">Uri</span><span class="o">.</span><span class="na">https</span><span class="p">(</span><span class="s">'kauth.kakao.com'</span><span class="p">,</span> <span class="s">'/oauth/authorize'</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="s">'response_type'</span><span class="o">:</span> <span class="s">'code'</span><span class="p">,</span>
          <span class="s">'client_id'</span><span class="o">:</span> <span class="s">'rest api key 작성'</span><span class="p">,</span>
          <span class="s">'redirect_uri'</span><span class="o">:</span> <span class="s">'http://localhost:8080/login/oauth2/code/kakao'</span><span class="p">,</span>
          <span class="s">'state'</span><span class="o">:</span> <span class="n">clientState</span><span class="p">,</span>
        <span class="p">});</span>

      <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">FlutterWebAuth</span><span class="o">.</span><span class="na">authenticate</span><span class="p">(</span>
          <span class="nl">url:</span> <span class="n">url</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span> <span class="nl">callbackUrlScheme:</span> <span class="s">"webauthcallback"</span>
      <span class="p">);</span>

      <span class="kd">final</span> <span class="n">body</span> <span class="o">=</span> <span class="kt">Uri</span><span class="o">.</span><span class="na">parse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="na">queryParameters</span><span class="p">;</span>

      <span class="n">print</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'카카오톡 로그인 실패 </span><span class="si">$error</span><span class="s">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>flutter</p>

<p>프론트 프레임워크로 flutter를 사용하고 있다.</p>

<p>로그인 버튼을 클릭했을 경우 <code class="language-plaintext highlighter-rouge">_signInWithKakao()</code>함수가 실행되도록 프론트 코드를 작성했다.</p>

<p>(프론트에서 직접 외부 api를 호출하지 않고 백엔드에서 호출하도록 할까 싶었지만 그러면 api 호출 횟수가 1회 늘어나는 꼴이 되는지라… 그냥 프론트에서 처리하기로 했다.)</p>

<p>client_id 같은 경우는 외부에 노출되어선 안되는 정보기 때문에 env파일 같은 곳에 저장해두기로 하자.</p>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">http://localhost:8080/login/oauth2/code/kakao</code>은 토큰 발급용 내부 api uri로, 인가코드 발급이 종료되면 바로 내부 api로 리다이렉트 되도록 했다.</p>

<blockquote>
  <p>인가 코드 받기 요청의 응답은 HTTP 302 리다이렉트되어, <code class="language-plaintext highlighter-rouge">redirect_uri</code>에 <code class="language-plaintext highlighter-rouge">GET</code> 요청으로 전달됩니다.</p>
</blockquote>

<h3 id="2-토큰-발급">2. 토큰 발급</h3>
<p><img width="779" alt="토큰 받기" src="https://github.com/lcqff/lcqff.github.io/assets/71930280/260b613a-7097-4709-987e-50666ecf57da" /></p>

<h4 id="기본-정보">기본 정보</h4>

<p><strong>URI</strong></p>

<table>
  <thead>
    <tr>
      <th>메서드</th>
      <th>URL</th>
      <th>인증 방식</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>POST</td>
      <td>https://kauth.kakao.com/oauth/token</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<p><strong>쿼리 파라미터</strong></p>

<table>
  <thead>
    <tr>
      <th>이름</th>
      <th>타입</th>
      <th>설명</th>
      <th>필수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>grant_type</td>
      <td>String</td>
      <td>authorization_code로 고정</td>
      <td>O</td>
    </tr>
    <tr>
      <td>client_id</td>
      <td>String</td>
      <td>앱 REST API 키[내 애플리케이션] &gt; [앱 키]에서 확인 가능</td>
      <td>O</td>
    </tr>
    <tr>
      <td>redirect_uri</td>
      <td>String</td>
      <td>인가 코드가 리다이렉트된 URI</td>
      <td>O</td>
    </tr>
    <tr>
      <td>code</td>
      <td>String</td>
      <td>인가 코드 받기 요청으로 얻은 인가 코드</td>
      <td>O</td>
    </tr>
    <tr>
      <td>client_secret</td>
      <td>String</td>
      <td>토큰 발급 시, 보안을 강화하기 위해 추가 확인하는 코드[내 애플리케이션] &gt; [보안]에서 설정 가능ON 상태인 경우 필수 설정해야 함</td>
      <td>X</td>
    </tr>
  </tbody>
</table>

<p>인가 코드 받기 요청의 응답은 <code class="language-plaintext highlighter-rouge">redirect_uri</code>에 <code class="language-plaintext highlighter-rouge">code</code> 파라미터로 전달된다.</p>

<p>redirect된 api에서 토큰 발급 api를 호출하는 것으로 토큰을 발급받을 수 있다.</p>

<p><strong>응답</strong></p>

<table>
  <thead>
    <tr>
      <th>이름</th>
      <th>타입</th>
      <th>설명</th>
      <th>필수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>token_type</td>
      <td>String</td>
      <td>토큰 타입, bearer로 고정</td>
      <td>O</td>
    </tr>
    <tr>
      <td>access_token</td>
      <td>String</td>
      <td>갱신된 사용자 액세스 토큰 값</td>
      <td>O</td>
    </tr>
    <tr>
      <td>id_token</td>
      <td>String</td>
      <td>ID 토큰 값</td>
      <td>X</td>
    </tr>
    <tr>
      <td>expires_in</td>
      <td>Integer</td>
      <td>액세스 토큰 만료 시간(초)</td>
      <td>O</td>
    </tr>
    <tr>
      <td>refresh_token</td>
      <td>String</td>
      <td>갱신된 사용자 리프레시 토큰 값, 기존 리프레시 토큰의 유효기간이 1개월 미만인 경우에만 갱신</td>
      <td>X</td>
    </tr>
    <tr>
      <td>refresh_token_expires_in</td>
      <td>Integer</td>
      <td>리프레시 토큰 만료 시간(초)</td>
      <td>X</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<div class="captionedImg">
  <img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/ff286312-78f6-4059-af48-e740adfadd93" />
  토큰을 받아오는 과정 
</div>

<h4 id="코드-1">코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/oauth2/code/kakao"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">LoginResponse</span><span class="o">&gt;</span> <span class="nf">getKakaoToken</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"code"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">loginService</span><span class="o">.</span><span class="na">getKakaoToken</span><span class="o">(</span><span class="n">code</span><span class="o">));</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>controller</p>

<p>Code도 DTO를 통해 받아올까 생각했는데 어차피 외부 api의 응답값이고, 스펙이 바뀔일은 없을 것 같아서 그냥 파라미터로 받아왔다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">LoginResponse</span> <span class="nf">getKakaoToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">KakaoTokenResponse</span> <span class="n">tokenResponse</span> <span class="o">=</span> <span class="n">tokenExchanger</span><span class="o">.</span><span class="na">getToken</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
        <span class="c1">//...</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>service</p>

<p><code class="language-plaintext highlighter-rouge">KakaoTokenResponse</code> DTO에는 accessToken과 expiresIn 필드가 존재한다.  expiresIn은 사용하진 않았는데 일단 넣어둠…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TokenExchanger</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">WebClient</span> <span class="n">webClient</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">GRANT_TYPE</span> <span class="o">=</span> <span class="s">"authorization_code"</span><span class="o">;</span>
  
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"spring.security.oauth2.client.provider.kakao.token-uri"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="no">KAKAO_REQUEST_URI</span><span class="o">;</span>
    
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.security.oauth2.client.registration.kakao.client-id}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="no">KAKAO_CLIENT_ID</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.security.oauth2.client.registration.kakao.redirect-uri}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="no">KAKAO_REDIRECT_URI</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">KakaoTokenResponse</span> <span class="nf">getToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">request_uri</span> <span class="o">=</span>
                <span class="no">KAKAO_REQUEST_URI</span> <span class="o">+</span> <span class="s">"?grant_type="</span> <span class="o">+</span> <span class="no">GRANT_TYPE</span> <span class="o">+</span> <span class="s">"&amp;client_id="</span> <span class="o">+</span> <span class="no">KAKAO_CLIENT_ID</span> <span class="o">+</span> <span class="s">"&amp;redirect_uri="</span>
                        <span class="o">+</span> <span class="no">KAKAO_REDIRECT_URI</span> <span class="o">+</span> <span class="s">"&amp;code="</span> <span class="o">+</span> <span class="n">code</span><span class="o">;</span>
        <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">KakaoTokenResponse</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">webClient</span><span class="o">.</span><span class="na">post</span><span class="o">()</span>
                <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="n">request_uri</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_FORM_URLENCODED</span><span class="o">)</span>
                <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
                <span class="o">.</span><span class="na">bodyToFlux</span><span class="o">(</span><span class="nc">KakaoTokenResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">blockFirst</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>utils</p>

<p>토큰 발급 외부 api를 호출하는 코드이다.</p>

<red>*주의</red>
<p>: Secret값을 사용하고 있지 않은지 확인하자. 사용하고 있다면 uri에 Secret값을 추가해야한다.</p>

<p><br /></p>

<p>외부 api 호출을 위해 <strong>webClient</strong>를 사용했다. webClient 대신 RestTemplate을 사용할 수도 있는데 webClient가 더 좋아보여서 webClient로… 
RestTemplate과 WebClient는 나중에 자세히 비교해서 글을 써보려 한다.</p>

<p class="box-error">‘org.springframework.web.reactive.function.client.WebClient’ that could not be found.</p>

<p>참고로 webClient사용시 위와 같은 오류가 발생할 수 있는데, WebClient에 Bean이 할당되지 못해 발생하는 문제로 아래 설정을 통해 해결할 수있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="nc">WebClient</span> <span class="nf">webClient</span><span class="o">(</span><span class="nc">WebClient</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>위 코드를 통해 제공받은 access token은 사용자에게 제공한 token의 일치 여부만 판별할 수 있을 뿐 <strong>token 내에 사용자 정보가 담겨있진 않다</strong>.</p>

<p>따라서 token을 통해 사용자를 식별하기 위해서는 사용자 정보 가져오기 api를 호출해 사용자 정보를 획득하거나, 사용자 정보를 가져온 다음 session과 같이 저장소에 저장된 사용자 정보를 확인하기 위한 key로 사용하는 수밖애 없다.</p>

<p>반면 <strong>JWT는 token 그 자체가 JSON 형식의 정보</strong>를 담고 있으며  디코딩을 통해 사용자 정보를 취득 가능하다. JWT에 대해서는 다음 게시글에서 자세히 알아보겠다.</p>

<h3 id="3-사용자-정보-가져오기">3. 사용자 정보 가져오기</h3>

<p><img width="790" alt="로그인 처리" src="https://github.com/lcqff/lcqff.github.io/assets/71930280/7eff638e-631b-4d4e-b2f6-7bf0c4d36e9c" /></p>

<h4 id="기본-정보-1">기본 정보</h4>

<p><strong>uri</strong></p>

<table>
  <thead>
    <tr>
      <th>메서드</th>
      <th>URL</th>
      <th>인증 방식</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET/POST</td>
      <td>https://kapi.kakao.com/v2/user/me</td>
      <td>액세스 토큰서비스 앱 어드민 키</td>
    </tr>
  </tbody>
</table>

<p><strong>요청 헤더</strong></p>

<table>
  <thead>
    <tr>
      <th>이름</th>
      <th>설명</th>
      <th>필수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Authorization</td>
      <td>Authorization: Bearer ${ACCESS_TOKEN} 인증 방식, 액세스 토큰으로 인증 요청</td>
      <td>O</td>
    </tr>
    <tr>
      <td>Content-type</td>
      <td>Content-type: application/x-www-form-urlencoded;charset=utf-8요청 데이터 타입</td>
      <td>O</td>
    </tr>
  </tbody>
</table>

<p><strong>응답</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">123456789</span><span class="p">,</span><span class="w">
    </span><span class="nl">"connected_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-04-11T01:45:28Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kakao_account"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
        </span><span class="nl">"profile_nickname_needs_agreement	"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"profile_image_needs_agreement	"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"홍길동"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"thumbnail_image_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://yyy.kakao.com/.../img_110x110.jpg"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"profile_image_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://yyy.kakao.com/dn/.../img_640x640.jpg"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"is_default_image"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"is_default_nickname"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">},</span><span class="w">
      </span><span class="err">//...</span><span class="w">
    </span><span class="p">},</span><span class="w">
		</span><span class="err">//...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>내가 사용하지 않을 응답값은 생략해두었다. 자세한 응답값은 문서를 참고하자.</p>

<h4 id="코드-2">코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="nc">LoginResponse</span> <span class="nf">getKakaoToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">KakaoTokenResponse</span> <span class="n">tokenResponse</span> <span class="o">=</span> <span class="n">tokenExchanger</span><span class="o">.</span><span class="na">getToken</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
        <span class="nc">KakaoUserInfo</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="n">userInfoFetcher</span><span class="o">.</span><span class="na">getKaKaoUserInfo</span><span class="o">(</span><span class="n">tokenResponse</span><span class="o">.</span><span class="na">accessToken</span><span class="o">());</span>
				<span class="c1">//사용자 조회</span>
        <span class="c1">//jwt 토큰 생성</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">LoginResponse</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="s">"temp Token"</span><span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>service</p>

<p>카카오 서버에 저장된 유저 정보를 가져오는 코드를 추가했다. 
이후  이 정보를 기반으로 JWT 토큰을 생성할 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserInfoFetcher</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">WebClient</span> <span class="n">webClient</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"spring.security.oauth2.client.provider.kakao.user-info-uri"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="no">KAKAO_REQUEST_URI</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">KakaoUserInfo</span> <span class="nf">getKaKaoUserInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">KakaoUserInfo</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">webClient</span><span class="o">.</span><span class="na">post</span><span class="o">()</span>
                <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="no">KAKAO_REQUEST_URI</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_FORM_URLENCODED</span><span class="o">)</span>
                <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"Bearer "</span> <span class="o">+</span> <span class="n">token</span><span class="o">)</span>
                <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
                <span class="o">.</span><span class="na">bodyToFlux</span><span class="o">(</span><span class="nc">KakaoUserInfo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">blockFirst</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>utils</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">record</span> <span class="nf">KakaoUserInfo</span><span class="o">(</span>
    <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"kakao_account"</span><span class="o">)</span>
    <span class="nc">KakaoAccount</span> <span class="n">kakaoAccount</span>
<span class="o">)</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">record</span> <span class="nf">KakaoAccount</span><span class="o">(</span>
            <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"profile_nickname_needs_agreement"</span><span class="o">)</span>
            <span class="nc">Boolean</span> <span class="n">profileNicknameNeedsAgreement</span><span class="o">,</span>

            <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"profile_image_needs_agreement"</span><span class="o">)</span>
            <span class="nc">Boolean</span> <span class="n">profileImageNeedsAgreement</span><span class="o">,</span>
            <span class="nc">Profile</span> <span class="n">profile</span><span class="o">,</span>
            <span class="nc">String</span> <span class="n">email</span><span class="o">,</span>

            <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"email_needs_agreement"</span><span class="o">)</span>
            <span class="nc">Boolean</span> <span class="n">emailNeedsAgreement</span><span class="o">,</span>

            <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"is_email_valid"</span><span class="o">)</span>
            <span class="nc">Boolean</span> <span class="n">isEmailValid</span><span class="o">,</span>

            <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"is_email_verified"</span><span class="o">)</span>
            <span class="nc">Boolean</span> <span class="n">isEmailVerified</span>
    <span class="o">){</span>
        <span class="kd">public</span> <span class="n">record</span> <span class="nf">Profile</span><span class="o">(</span>
                <span class="nc">String</span> <span class="n">nickname</span><span class="o">,</span>

                <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"profile_image_url"</span><span class="o">)</span>
                <span class="nc">String</span> <span class="n">profileImageUrl</span><span class="o">,</span>

                <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"is_default_image"</span><span class="o">)</span>
                <span class="nc">Boolean</span> <span class="n">isDefaultImage</span><span class="o">,</span>

                <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"is_default_nickname"</span><span class="o">)</span>
                <span class="nc">Boolean</span> <span class="n">isDefaultNickname</span>
        <span class="o">)</span> <span class="o">{}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>dto</p>

<p>위에서 서술했 듯 ‘동의항목’을 선택으로 설정해두었더니 로그인시 동의항목 화면이 뜨지 않고 바로 Profile이 null로 전달되는 문제가 있었다;
필수로 변경하였더니 정상적으로 값이 입력되었다. 🤔</p>

<p><img src="https://github.com/lcqff/lcqff.github.io/assets/71930280/aff60774-2068-4d25-b67f-589edd9b82b3" alt="성공" /></p>

<p>카카오 정보 받아오기 성공</p>

<p>이제 받아온 정보를 가지고 JWT를 생성하는 단계만 남았다.</p>

<p>JWT에 대한 정보와 그 과정은 다음 게시글에서…..😄</p>

<h2 id="고민거리들">고민거리들</h2>

<p><strong><del>Cors 에러</del></strong></p>

<p>음? 분명 외부 api를 불러오는 과정에서 Cors 오류가 발생했었는데 갑자기 확장 프로그램을 꺼도 정상 작동한다🤔</p>

<p>Cors가 아니라 코드 문제였을까….? 그건 그렇고 외부 api를 호출하면 당연히 Cors가 발생해야할 것 같은데 발생하지 않는 것도 신기하다.</p>

<p><br /></p>

<p><strong>소셜 로그인 확장</strong></p>

<p>현 애플리케이션은 Kakao뿐만 아니라 Google 소셜 로그인 또한 가능하도록 계획돼있다.</p>

<p>DTO는 각 소셜 로그인이 제공하는 응답 형태가 다르니 어쩔수 없다 쳐도, 다른 소셜 로그인이 추가될때마다 동일한 기능을 하는 메소드를 각 소셜 로그인 별로 추가하는 건 너무 별로다. 구글 로그인을 추가하면서 한 번 방법을 찾아봐야겠다…</p>

<hr />

<p><br /></p>

<blockquote>
  <p>배운 점: 소셜 로그인 기능 하나를 구현하면서 정말 시행착오가 많았다… 특히 코드가 아니라 소셜 로그인 설정에서 생긴 문제가 많았다. (flutter는 할많하않) <br />
그래도 로그인 원리와 그 과정을 알게되니 정말 좋다🥹</p>
</blockquote>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2024-05-01">01 May 2024</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Backend-Study">Backend-Study</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#Backend">#Backend</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#Spring">#Spring</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//blog_update5/"> &laquo; 24.04.08 블로그 업데이트5</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//docker1-front/">인프라 스터디 (1) Docker로 프론트 배포하기 &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <script src="https://utteranc.es/client.js"
        repo="lcqff/blog_comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<!-- 
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#tutorial">tutorial (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#flutter">flutter (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Javascript">Javascript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#React">React (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#KakaoTecCampus">KakaoTecCampus (17)</a>
                
                    <a class="mt-1 mb-1" href="/categories#블로그_업데이트">블로그_업데이트 (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Algorithm">Algorithm (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CS">CS (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Backend-Study">Backend-Study (14)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Works">Works (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#일상">일상 (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Keeper">Keeper (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DooRe">DooRe (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Infra">Infra (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#세차새차">세차새차 (3)</a>
                
            
            
		</div>
	</div>
</div> -->

<div class="jumbotron fortags">
	<div class="d-flex h-100 justify-content-center">
		<div class="col-12 py-3">
            <div class="category-container">
                <div class="category-item">
                    <div class="parent_cat" style="font-weight: bold;">
                        <a href="/index.html">
                             전체 글
                             <span>63</span>
                        </a>
                    </div>
                </div>
                
                <!-- 카테고리 목록을 가로로 배치 -->
                <div class="category-item">
                    <div class="parent_cat">CS</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#CS">
                                    CS
                                    <span>2</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Algorithm">
                                    Algorithm
                                    <span>2</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">BackEnd</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#Keeper">
                                    Keeper
                                    <span>2</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#DooRe">
                                    DooRe
                                    <span>4</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#세차새차">
                                    세차새차
                                    <span>3</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Infra">
                                    Infra
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Backend-Study">
                                    Backend-Study
                                    <span>14</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">FrontEnd</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#Javascript">
                                    Javascript
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#React">
                                    React
                                    <span>1</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#KakaoTecCampus">
                                    KakaoTecCampus
                                    <span>17</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#flutter">
                                    flutter
                                    <span>3</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#Works">
                                    Works
                                    <span>1</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <div class="category-item">
                    <div class="parent_cat">기타</div>
                    <div class="common-list">
                        <div>
                            
                            <div>
                                <a href="/categories#블로그_업데이트">
                                    블로그_업데이트
                                    <span>7</span>
                                </a>
                            </div>
                            
                            <div>
                                <a href="/categories#일상">
                                    일상
                                    <span>3</span>
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2024 Pam Tree 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 

<!-- 
<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>
 -->

</body>
</html>
