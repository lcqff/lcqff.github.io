---
layout: post
title: "ì‚¬ìš©ì ì—†ëŠ” ì„œë¹„ìŠ¤ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸í•˜ê¸° (1) - Scouter"
author: pam
categories: [SOFO]
tags: [Infra, ì„±ëŠ¥] 
image: https://github.com/user-attachments/assets/57ce10cb-f9a2-47ad-8f45-df3c2a03621b
description: "ì„±ëŠ¥ ì¸¡ì •ì„ ìœ„í•´ Scouterë¥¼ ì„¤ì¹˜í•´ APMì„ ê´€ì°°í•©ë‹ˆë‹¤."
featured: false
toc: true
summary: "ì„¸ì°¨ìƒˆì°¨ì—ì„œ ì¼í•˜ë©´ì„œ Datadogì„ ì¨ë³¼ ê¸°íšŒê°€ ìˆì—ˆë‹¤! 
ê·¸ëŸ¬ë‚˜ ì—¬ëŸ¬ ë¬¸ì œê°€ ê²¹ì¹˜ë©´ì„œ ì‹¤ì œë¡œ APMì„ ì‚¬ìš©í•´ë³´ì§„ ëª»í–ˆë‹¤...
APMì„ ì§ì ‘ ì‚¬ìš©í•´ë³¼ ê¸°íšŒë¥¼ ë†“ì¹œê²Œ ì•„ì‰¬ìš´ ë§ˆìŒì„ ë’¤ë¡œí•˜ê³ , ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì¸ SOFOë¥¼ ê°œë°œí•˜ë©° ì„±ëŠ¥ í–¥ìƒì„ ì–´ë–»ê²Œ ì‹¤í˜„í•˜ë©´ ì¢‹ì„ì§€ ê³ ë¯¼ì´ ëë‹¤.
SOFOëŠ” ì•„ì§ ê°œë°œë‹¨ê³„ì¸, ì‚¬ìš©ìê°€ 0ì¸ ì„œë¹„ìŠ¤ì˜€ê¸° ë•Œë¬¸ì—...
ê·¸ëŸ¬ë‚˜ ìµœê·¼ì— ì¸ê°•ì„ í†µí•´ ì¢‹ì€ ì•„ì´ë””ì–´ë¥¼ ìŠ¤ì³ê°€ë“¯ ë°°ìš°ê²Œ ë˜ì—ˆê³ , ì•„ì‰¬ì› ë˜ APM ì‚¬ìš©ê³¼ SOFO ì„±ëŠ¥ í–¥ìƒì„ ë™ì‹œì— ì‹¤ì²œí•´ë³´ë ¤ í•œë‹¤!"
---


---

<br>
![image](https://github.com/user-attachments/assets/57ce10cb-f9a2-47ad-8f45-df3c2a03621b)

# ê°œìš”

ì„¸ì°¨ìƒˆì°¨ì—ì„œ ì¼í•˜ë©´ì„œ Datadogì„ ì¨ë³¼ ê¸°íšŒê°€ ìˆì—ˆë‹¤! 

ê·¸ëŸ¬ë‚˜ ì—¬ëŸ¬ ë¬¸ì œê°€ ê²¹ì¹˜ë©´ì„œ (1. Elastic beanstalkì˜ Auto Scalingì— ì˜í•´ datadog agentê°€ ìê¾¸ ì‚­ì œë¨,  2. ë‚´ê°€ ë§ˆìŒëŒ€ë¡œ ì¸í”„ë¼ë¥¼ ì†ëŒˆìˆ˜ ì—†ì—ˆìŒ, 3. ì„¸ì°¨ìƒˆì°¨ ì¸¡ì—ì„œë„ ì˜ ëŒì•„ê°€ê³  ìˆëŠ” ì¸í”„ë¼ë¥¼ ì†ëŒ€ê°€ë©° datadogì„ ì‚¬ìš©í•˜ê³ ì‹¶ì§„ ì•Šìœ¼ì‹ ë“¯â€¦, 4. Datadog ë„ˆë¬´ ë¹„ì‹¸ë‹¤) ì‹¤ì œë¡œ APMì„ ì‚¬ìš©í•´ë³¼ ê¸°íšŒëŠ” ì—†ì—ˆë‹¤

APMì„ ì§ì ‘ ì‚¬ìš©í•´ë³¼ ê¸°íšŒë¥¼ ë†“ì¹œê²Œ ì•„ì‰¬ìš´ ë§ˆìŒì„ ë’¤ë¡œí•˜ê³ , ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì¸ SOFOë¥¼ ê°œë°œí•˜ë©° ì„±ëŠ¥ í–¥ìƒì„ ì–´ë–»ê²Œ ì‹¤í˜„í•˜ë©´ ì¢‹ì„ì§€ ê³ ë¯¼ì´ ëë‹¤.

SOFOëŠ” ì•„ì§ ê°œë°œë‹¨ê³„ì¸, ì‚¬ìš©ìê°€ 0ì¸ ì„œë¹„ìŠ¤ì˜€ê¸° ë•Œë¬¸ì—â€¦

ê·¸ëŸ¬ë‚˜ ìµœê·¼ì— ì¸ê°•ì„ ë“¤ìœ¼ë©° ì¢‹ì€ ì•„ì´ë””ì–´ë¥¼ ìŠ¤ì³ê°€ë“¯ ë°°ìš°ê²Œ ë˜ì—ˆê³ , APM ì‚¬ìš©ê³¼ SOFO ì„±ëŠ¥ í–¥ìƒì„ ë™ì‹œì— ì‹¤ì²œí•´ë³´ë ¤ í•œë‹¤!

ì´ë²ˆ ê²Œì‹œê¸€ì—ì„œ ë‹¤ë£° ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.

> Scouter ì„¤ì¹˜ ë° ì‹¤í–‰
> 

ì¶”í›„ ê²Œì‹œê¸€ì—ì„œëŠ” JMeterë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê³ , Scouterë¥¼ í†µí•´ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•˜ê³  ìˆ˜ì •í•´ SOFOì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ê²ƒì´ë‹¤.

# Scouter

![image](https://github.com/user-attachments/assets/4f16b004-e1e1-4031-925d-9228626eb142)


ScouterëŠ” **Agent**ì™€ **Collector,** ê·¸ë¦¬ê³  **Client(Viewer)** í”„ë¡œê·¸ë¨ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

- **Agent**: WASì™€ í˜¸ìŠ¤íŠ¸ PCì˜ ì„±ëŠ¥ ì§€í‘œë¥¼ ìˆ˜ì§‘í•˜ëŠ” í•µì‹¬ ë„êµ¬
    - Java Agent: ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë¶€ì°©ë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ ì§€í‘œ ìˆ˜ì§‘
    - Host Agent: í˜¸ìŠ¤íŠ¸ PCì— ë¶€ì°©ë˜ì–´ í˜¸ìŠ¤íŠ¸ PC ì„±ëŠ¥ ì§€í‘œ ìˆ˜ì§‘
- **Collector**: Agentë¡œë¶€í„° ëª¨ë“  ì„±ëŠ¥ ì§€í‘œë¥¼ ìˆ˜ì§‘
- **Client**: Collectorë¡œë¶€í„° ì„±ëŠ¥ ì§€í‘œë¥¼ ë°›ì•„ ì‚¬ìš©ì ì¹œí™”ì  ì¸í„°í˜ì´ìŠ¤ë¡œ ì‹œê°í™”

# Scouter Agent ì„¤ì¹˜

- [Scouter ReadMe](https://github.com/scouter-project/scouter/blob/master/scouter.document/main/Setup.md) (í•œêµ­ ê°œë°œì´ë¼ ê·¸ëŸ°ê°€ í•œê¸€ ë²„ì „ë„ ìˆì—ˆë˜ê±° ê°™ìœ¼ë‹ˆ ì°¾ì•„ë³´ê¸¸â€¦)

![image](https://github.com/user-attachments/assets/6d4e8a48-88b2-428a-911a-0ba865effb65)

ì´ë²ˆì— ë‚´ê°€ ë‹¤ë£° ì¸í”„ë¼ êµ¬ì¡°ë„ëŠ” ìœ„ì™€ ê°™ë‹¤. 

ë‚˜ëŠ” Host agentì™€ Collectorë¥¼ Ec2ì— ì„¤ì¹˜í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í–ˆëŠ”ë°, **Docker**ë¥¼ ì‚¬ìš©í•˜ëŠ” í¸ì´ ë‚˜ì„ ê±° ê°™ë‹¤. (ì´í›„ ë¦¬íŒ©í† ë§í•˜ë©´ ì¶”ê°€í•˜ê² ìŒâ€¦)

## Scouter Agent & Collector íŒŒì¼ ë‹¤ìš´

> 2025.01.03 ê¸°ì¤€ Scouter ìµœì‹  ë²„ì „ì€ **scouter-all-2.20.0.tar.gz**ì´ë‹¤.

scouter-all-xxx íŒŒì¼ì€ Agentì™€ Collectorê°€ ë¬¶ì—¬ìˆëŠ” íŒŒì¼ì´ë‹¤. Ec2ì— ì„¤ì¹˜ í›„ ì••ì¶•í•´ì œí•˜ë„ë¡ í•˜ì.

```bash
wget https://github.com/scouter-project/scouter/releases/download/v2.20.0/scouter-all-2.20.0.tar.gz
tar -xvf [scouter-all-2.20.0.tar.gz](https://github.com/scouter-project/scouter/releases/download/v2.20.0/scouter-all-2.20.0.tar.gz)
rm scouter-all-2.20.0.tar.gz 
```

![image](https://github.com/user-attachments/assets/a17e694c-bbf6-4741-ae95-e59333cfe78f)

ì„¤ì¹˜ í›„ Scouter í´ë” êµ¬ì¡°ëŠ” ìœ„ì™€ ê°™ë‹¤.

<br>

## ì‚¬ì „ ì‘ì—…

### 6100 port open

![image](https://github.com/user-attachments/assets/88bb65b0-0786-41b1-80ae-2ecf1f32f27d)

ScouterëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 6100 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í†µì‹ í•˜ê¸° ë•Œë¬¸ì— Ec2ì˜ ì¸ë°”ìš´ë“œ ê·œì¹™ì— 6100 í¬íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ì.

### Java 8 ì„¤ì¹˜

```java
sudo apt install openjdk-8-jdk
```

localì—ì„œ ì ê¹ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ì„ë•Œ [ì´ëŸ¬í•œ ë¬¸ì œ](https://github.com/scouter-project/scouter/issues/975)ê°€ ìˆì–´ì„œ Ec2ì—ì„  ì• ì´ˆì— Java 11ë²„ì „ì„ ë‹¤ìš´ë¡œë“œ í–ˆ~~ë‹¤.~~ëŠ”ë° ë™ì‘í•˜ì§€ ì•Šì•„ ë‹¤ì‹œ ì°¾ì•„ë³´ë‹ˆ Scouter ServerëŠ” java 8ì—ì„œë§Œ ë™ì‘í•œë‹¤ê³  í•œë‹¤â€¦ (?)

- ì°¸ê³ : https://0andwild.tistory.com/44

JDK 1.8ì„ ë‹¤ìš´ë°›ë„ë¡ í•˜ìâ€¦

<br>

# Collector Server ì‹¤í–‰

## ì‹¤í–‰

```java
sh ./server/startup.sh
```

![image](https://github.com/user-attachments/assets/77e83caa-afde-43d9-bac9-b789044972d8)

ì •ìƒì ìœ¼ë¡œ Collectorê°€ ì‹¤í–‰ë˜ì—ˆë‹¤.

<br>

# Host Agent ì‹¤í–‰

## scouter.conf ì‘ì„±

```bash
vi ./agent.host/conf/scouter.conf
```
```
### scouter host configruation sample
net_collector_ip=127.0.0.1
net_collector_udp_port=6100
net_collector_tcp_port=6100
#cpu_warning_pct=80
#cpu_fatal_pct=85
#cpu_check_period_ms=60000
#cpu_fatal_history=3
#cpu_alert_interval_ms=300000
#disk_warning_pct=88
#disk_fatal_pct=92
```

ê¸°ë³¸ ì½”ë“œì˜ ìœ„ 3 ë¼ì¸ë§Œ ì£¼ì„í•´ì œí•œë‹¤. 

Collectorì™€ Host Agentê°€ ë™ì¼ ì„œë²„ ìœ„ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— `net_collector_ip`ëŠ” Localhostë¡œ í•´ì£¼ì—ˆë‹¤. 
Collectorë¥¼ ë‹¤ë¥¸ ì„œë²„ë¡œ ë¹¼ë©´ ì¢‹ì„ ê±° ê°™ê¸´ í•˜ì§€ë§Œ AWS í”„ë¦¬í‹°ì–´ ë¬¸ì œë¡œâ€¦.ğŸ˜…

## ì‹¤í–‰

```bash
#!/usr/bin/env bash

nohup java  -classpath ./scouter.host.jar scouter.boot.Boot ./lib > nohup.out &
sleep 1
tail -100 nohup.out
```

```bash
sh ./host.sh
```

ì°¸ê³ ë¡œ [host.sh](http://host.sh) ì½”ë“œê°€ ë™ì¼ ìœ„ì¹˜ì— ìˆëŠ” `scouter.host.jar`ì„ ê°€ë¦¬í‚¤ê³  ìˆê¸° ë•Œë¬¸ì— sh íŒŒì¼ê³¼ ë™ì¼í•œ ìœ„ì¹˜ì—ì„œ ì‹¤í–‰ì‹œì¼œì•¼ ëœë‹¤â€¦

<br>

# Java Agent ì‹¤í–‰

> ì• í”Œë¦¬ì¼€ì´ì…˜ì— Java Agentë¥¼ ë¶€íƒí•˜ê¸° ì „ì— ë¨¼ì € Clientë¥¼ í†µí•´ Collectorì™€ Host Agentê°€ ì •ìƒë™ì‘í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸í•´ë³´ëŠ”ê²ƒì´ ì¢‹ê² ë‹¤.
> 

Ec2 ìœ„ì— WASë¥¼ ëŒë¦¬ê³  ìˆëŠ” ê²½ìš° Scouter.confë¥¼ ìˆ˜ì •í•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” ê±¸ë¡œ ê°„ë‹¨íˆ Java Agentë¥¼ ì‹¤í–‰í• ìˆ˜ ìˆì§€ë§Œ, ë‚˜ëŠ” Docker ìœ„ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë„ì–´ë†“ì•˜ê¸° ë•Œë¬¸ì— **Dockerfile**ì„ ìˆ˜ì •í•´ì•¼í–ˆë‹¤.

## scouter.conf ìˆ˜ì •

```java
vi ./agent.java/conf/scouter.conf
```

```docker
### scouter java agent configuration sample
#obj_name=WAS-01
net_collector_ip={ec2 private ip}
net_collector_udp_port=6100
net_collector_tcp_port=6100
#hook_method_patterns=sample.mybiz.*Biz.*,sample.service.*Service.*
#trace_http_client_ip_header_key=X-Forwarded-For
#profile_spring_controller_method_parameter_enabled=false
#hook_exception_class_patterns=my.exception.TypedException
#profile_fullstack_hooked_exception_enabled=true
#hook_exception_handler_method_patterns=my.AbstractAPIController.fallbackHandler,my.ApiExceptionLoggingFilter.handleNotFoundd
ErrorResponse
#hook_exception_hanlder_exclude_class_patterns=exception.BizException
~                                                                        
```

ìš°ì„  Java Agentì˜ ì„¤ì •íŒŒì¼ì„ ìˆ˜ì •í•œë‹¤.

í˜„ì¬ Ec2ìœ„ì— Scouter Serverê°€ ë– ìˆìœ¼ë¯€ë¡œ Collector ipëŠ” Ec2ì˜ ì‚¬ì„¤ ì£¼ì†Œë¡œ í•œë‹¤. 

## Back.Dockerfile ìˆ˜ì •

```docker
# ê¸°ì¡´
FROM openjdk:17-jdk-slim
WORKDIR /app

COPY soundflyer-infra/deploy/docker/data/server/MusicPlatform-0.0.1-SNAPSHOT.jar .

ENTRYPOINT [ \
    "java", \
    "-Dspring.profiles.active=dev", \
    "-Duser.timezone=Asia/Seoul", \
    "-jar", \
    "MusicPlatform-0.0.1-SNAPSHOT.jar" \
]

# ìˆ˜ì •    
FROM openjdk:17-jdk-slim
WORKDIR /app

COPY soundflyer-infra/deploy/docker/data/server/MusicPlatform-0.0.1-SNAPSHOT.jar .
COPY apm/scouter/agent.java/scouter.agent.jar .
COPY apm/scouter/agent.java/conf/scouter.conf .

ENTRYPOINT [ \
    "java", \
    "-javaagent:/app/scouter.agent.jar", \
    "-Dscouter.config=/app/scouter.conf", \
    "-Dspring.profiles.active=dev", \
    "-Duser.timezone=Asia/Seoul", \
    "-jar", \
    "MusicPlatform-0.0.1-SNAPSHOT.jar" \
]
```

Docker ì»¨í…ìŠ¤íŠ¸ì— scouter.agent.jarê³¼ ì„¤ì •íŒŒì¼ì„ ë³µì‚¬í•´ì˜¨ í›„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ ì‹œí‚¬ ë•Œ ë¶€ì°©í•´ì£¼ì—ˆë‹¤. 

  <br>

![image](https://github.com/user-attachments/assets/a4e118c6-4371-4ac1-87df-69c3ecf37224)

ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ë¡œê·¸ë¥¼ ì‚´í´ë³´ë©´ Spring ì‹¤í–‰ ì „ì— Scouterê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br>

# Client ì„¤ì¹˜

> í´ë¼ì´ì–¸íŠ¸ PCì—ëŠ” java 11ì´ìƒì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼í•œë‹¤.
> 

```bash
xattr -cr scouter.client.app
```

[Scouter Client íŒŒì¼](https://github.com/scouter-project/scouter/releases)ì„ ë‹¤ìš´ ë° ì••ì¶•í•´ì œ í•œ í›„ í™•ì¥ ì†ì„±ì„ ì‚­ì œí•´ì£¼ì.


![image](https://github.com/user-attachments/assets/fad8ce60-1727-458a-8e89-dcfd5f90ff58)

ë‚˜ëŠ” ë”ë¸” í´ë¦­ìœ¼ë¡œ ì‹¤í–‰ì´ ì•ˆë˜ì–´ì„œ `scouter.client/Contents/MacOS/scouter`ë¥¼ ì§ì ‘ ì‹¤í–‰ì‹œì¼°ë‹¤.


 Server Address: {Ec2 public ip}:6100  
 ID: admin(ì´ˆê¸°ê°’)  
 Password: (ì´ˆê¸°ê°’)  
{: .box-note}

<br>

# Scouter ëª¨ë‹ˆí„°ë§


![image](https://github.com/user-attachments/assets/0cfd22ab-76d8-465b-8a45-8eb49f58d8de)

Hostë§Œ ì—°ê²°ë˜ê³  WASëŠ” ì—°ê²°ë˜ì§€ ì•Šì€ ëª¨ìŠµì´ë‹¤. 

ì‚´í´ë³´ë©´ object ì°½ì— Linuxë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. Host AgentëŠ” Host pcì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê¸°ì— EC2ì˜ CPU ìˆ˜ì¹˜ëŠ” ì •ìƒì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://github.com/user-attachments/assets/f880a0da-6851-4017-a346-691d1993610a)

WAS ì—°ê²° í›„ ëª¨ìŠµì´ë‹¤. Objectì— tomcatì´ ì¶”ê°€ì ìœ¼ë¡œ ì—°ê²°ëœ ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- **Recent User**: ìµœê·¼ í™œì„±í™”ëœ ì‚¬ìš©ìì˜ ìˆ˜
- **TPS(Transaction Per Second)**: ì´ˆë‹¹ ì–¼ë§ˆë‚˜ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬ê°€ëŠ¥í•œì§€ ë³´ì—¬ì£¼ëŠ” ì§€í‘œ
- **Elapsed Time**: ì‘ì—… ì™„ë£Œì— ê±¸ë¦¬ëŠ” ì‹œê°„. ì‚¬ìš©ì ì…ì¥ì—ì„œì˜ ì‘ë‹µì‹œê°„.
- **Heap Used**: JVMì´ ì‚¬ìš©í•˜ê³  ìˆëŠ” Heap ë©”ëª¨ë¦¬. Garbage Collection íš¨ìœ¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- **XLog**: íŠ¸ëœì ì…˜ ì‹¤í–‰ ì •ë³´ë¥¼ ì‹œê°í™”í•´ì¤€ë‹¤.





<br>
<br>


---

ë‹¤ìŒ ê²Œì‹œê¸€ì—ì„œëŠ” JMeterë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€í•˜ë¥¼ ì¼ìœ¼í‚¤ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ëŠ” ë¶€ë¶„ì„ í™•ì¸í•œ ë‹¤ìŒì— ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ë‚´ìš©ì„ ì‘ì„±í•´ë³¼ ì˜ˆì •ì´ë‹¤